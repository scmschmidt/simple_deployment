#!/bin/bash

set -e
LANG=C

# Include shared functions.
. "${0%*${0##*/}}include"

# Get current status.
status=$(< "${status_file}")

# A reboot is only triggered, if the status is set to `recovery_set`.
[ "${status}" != 'recovery_set'  ] && exit_on_error "Invalid status for reboot: ${status}"

# Reboot if necessary (the recovery snapshot is not the active one).
update_ss_vars
if [ "${ss_recovery}" == "${ss_active}" ] ; then
    log "The recovery snapshot (${ss_recovery}) is already active. No reboot required."
    exit 0
fi
reboot

